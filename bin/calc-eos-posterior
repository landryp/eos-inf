#!/bin/bash

obslist=$1
eosbank=$2
numeos=$3
nummass=$4
mprior=$5

while IFS=, read -r likepath obstype
do
	likemetapath="${likepath%.*}.in"
	parse-likelihood-samples $obstype $likepath $likemetapath

	while IFS=, read -r prop lb ub bw
	do
		if [ "$prop" == "m" ]; then # FIXME: get this workin for cbc
			priorpath="${likepath%.*}_prior.json"
			sample-priors $eosbank $priorpath -O $obstype -n $numeos -N $nummass -m "$lb,$ub" -p $mprior
			break
		fi
	done < $likemetapath

	priorcsvpath="${priorpath%.*}.csv"
	convert-json-csv $priorpath $priorcsvpath

done < $obslist

# pass to weighsamples along with bandwidth, produce tmp eospost.csv
# convert to json with convert-json-csv

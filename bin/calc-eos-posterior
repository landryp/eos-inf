#!/bin/bash

obslist=$1
eosbank=$2
numeos=$3
nummass=$4
mprior=$5

while IFS=, read -r likepath obstype
do
	likemetapath="${likepath%.*}.in"
	parse-likelihood-samples $obstype $likepath $likemetapath

	while IFS=, read -r prop lb ub bw
	do
		if [ "$prop" == "m" ]; then # FIXME: get this workin for cbc
			priorpath="${likepath%.*}_prior.json"
			sample-priors $eosbank $priorpath -O $obstype -n $numeos -N $nummass -m "$lb,$ub" -p $mprior
			break
		fi
	done < $likemetapath

	priorcsvpath="${priorpath%.*}.csv"
	convert-json-csv $priorpath $priorcsvpath

	postpath="${likepath%.*}_post.csv"
	weigh-samples $likepath $priorcsvpath $postpath m R -v --bandwidth=$bw #--weight-column Prior --weight-column-is-log Prior --invert-weight-column Prior 

	eospath="${likepath%.*}_eos.csv"
	marginalize-samples $postpath EoS -o $eospath --weight-column logweight --weight-column-is-log logweight -v

done < $obslist

# convert to json with convert-json-csv

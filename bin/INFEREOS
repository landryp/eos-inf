#!/bin/bash

jobi=$1
numjobs=$2
perdir=$3
mpereos=$4
gwfile=$5
gpfile=$6
outdir=$7
mrng=$8 # 1.06,1.46,1.24,1.72
Mcrng=$9 # 1.184,1.188
Mobs=$10 # 1.93

sampfile=$outdir/SAMP.csv
weightsfile=$outdir/SAMPweights.csv

draweos $jobi $numjobs $perdir $gpfile $outdir

getprops $jobi $numjobs $perdir $outdir

getbinaries $mpereos -v -m $mrng -M $Mcrng -d $outdir/ -o $outdir/

collectbinaries -v -M $Mobs -d $outdir/ -o $outdir/

weighsamps $gwfile $sampfile $weightsfile

kde-corner-samples -s GPprior $sampfile -s GPpost $weightsfile -s GWpost $gwfile -v --weight-column GPpost logweights --weight-column-is-log GPpost -o $outdir m1_source m2_source lambda1 lambda2 --color GPprior blue --color GPpost red --color GWpost green -r m1_source 1.35 1.60 -r m2_source 1.15 1.40 -r lambda1 0. 500. -r lambda2 0. 1000. -b m1_source 0.02 -b m2_source 0.02 -b lambda1 10. -b lambda2 10.

### fix below ###
#plot-process -s GPprior ./dat/SAMP.csv -s GPpost ./dat/SAMPweights.csv -v --weight-column GPpost logweights --weight-column-is-log GPpost -o ./dat/ pressurec2 baryon_density 1e12 1e16 --eos-column GPprior EoS --eos-column GPpost EoS --eos-dir GPprior ./dat/eos/ --eos-dir GPpost ./dat/eos/ --eos-basename GPprior eos-draw-%06d.csv --eos-basename GPpost eos-draw-%06d.csv --bns-dir GPprior ./dat/ --bns-dir GPpost ./dat/ --bns-basename GPprior macro-draw-%06d.csv --bns-basename GPpost macro-draw-%06d.csv -l pressurec2 -l baryon_density

#!/bin/bash

indir=$1 #./eos-inf
jobi=$2 #0
numjobs=$3 #1000
perdir=$4 #100
mpereos=$5 #1
gwfile=$6 #${indir}/in/gwPhenomPNRT_post-lospin.csv
gpfile=$7 #${indir}/in/gpr_phi.hdf5
dbdir=$8 #./tmp
outdir=$9 #./tmp_1k
mrng=${10} #1.06,1.46,1.24,1.72
Mcrng=${11} #1.184,1.188
Mobs=${12} #1.93
crustdir=${13} # ./gpr-eos-gw170817/eos/eos

sampfile=$outdir/SAMP.csv
weightsfile=$outdir/SAMPweights.csv

if test ! -f "$dbdir/CRUSTS.dat"; then

	echo '### record crusts affixed to Gaussian process EoSs ###' > $dbdir/CRUSTS.dat
	echo 'EoS, crust' > $dbdir/CRUSTS.dat

	draweos $jobi $numjobs $perdir $gpfile $dbdir $crustdir

	getprops $jobi $numjobs $perdir $dbdir

fi

getbinaries $mpereos -v -m $mrng -M $Mcrng -d $dbdir/ -o $outdir/

collectbinaries -v -M $Mobs -d $dbdir/ -i $outdir/ -o $outdir/ -p M=1.4,R+M=1.4,Lambda+M=1.4,I+M=1.4,Mb+M=1.338,I -c pc1,pc2,ec1,ec2

weighsamps $gwfile $sampfile $weightsfile

plotposts $sampfile $weightsfile $gwfile $dbdir $outdir $indir $perdir
